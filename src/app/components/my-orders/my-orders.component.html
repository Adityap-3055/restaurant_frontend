<div class="orders-container">
  <h2 class="page-title">Order History</h2>

  <div *ngIf="loading" class="spinner-container">
    <mat-spinner diameter="50" color="warn"></mat-spinner>
  </div>

  <p *ngIf="errorMsg" class="error-text">{{ errorMsg }}</p>

  <p
    *ngIf="!loading && orders.length === 0 && !errorMsg"
    style="text-align: center"
  >
    No orders found.
  </p>

  <div class="orders-list">
    <mat-card *ngFor="let order of orders" class="order-card" elevation="3">
      <mat-card-header>
        <mat-card-title class="order-id"
          >Order ID: {{ order.id }}</mat-card-title
        >
        <mat-card-subtitle class="customer-name"
          >Customer: {{ order.customerName }}</mat-card-subtitle
        >
      </mat-card-header>

      <mat-card-content>
        <p class="details">
          Phone: {{ order.customerPhoneNumber }} | Address:
          {{ order.customerAddress }}
        </p>

        <mat-divider></mat-divider>

        <h3 class="items-title">Order Items:</h3>
        <mat-list dense>
          <mat-list-item *ngFor="let item of getGroupedItems(order.orderItems)">
            <span matListItemTitle>{{ item.name }} (x{{ item.qty }})</span>
            <span matListItemLine
              >₹{{ (item.qty * item.price).toFixed(2) }}</span
            >
          </mat-list-item>
        </mat-list>

        <mat-divider></mat-divider>
      </mat-card-content>

      <mat-card-actions class="card-actions">
        <span class="total-price"
          >Total: ₹{{ order.totalPrice.toFixed(2) }}</span
        >
        <button
          mat-raised-button
          class="btn-delete"
          (click)="deleteOrder(order.id)"
        >
          Delete
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
